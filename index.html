<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>V√°noƒçn√≠ pohlednice ‚Äì Editor</title>
<style>
  body {
    font-family: sans-serif;
    display: flex;
    gap: 20px;
    padding: 20px;
  }

  /* Panel vpravo */
  #panel {
    width: 160px;
    padding-right: 10px;
    border-right: 2px solid #ccc;

    /* ‚Üì NOV√â: panel je posuvn√Ω */
    max-height: 90vh;
    overflow-y: auto;
  }

  #panel h3 {
    margin-top: 0;
  }

  #panel img {
    width: 100%;
    margin-bottom: 15px;
    cursor: grab;
    touch-action: none; /* d≈Øle≈æit√© pro mobily */
  }

  /* Pohlednice vlevo */
  #canvas {
    width: 600px;
    height: 400px;
    border: 3px solid #444;
    border-radius: 12px;
    position: relative;
    overflow: hidden;

    background-image: url("muzeum_pozadi.jpg");
    background-size: cover;
    background-position: center;
  }

  /* Prvky na pl√°tnƒõ */
  .item {
    position: absolute;
    width: 120px;
    cursor: grab;
    user-select: none;
    touch-action: none;
  }

  #save {
    margin-top: 25px;
    padding: 10px 15px;
    cursor: pointer;
  }
</style>
</head>
<body>

<!-- Panel -->
<div id="panel">
  <h3>V√°noƒçn√≠ postavy</h3>

  <img src="Barborka.png" draggable="true" class="draggable">
  <img src="Ambro≈æ.png" draggable="true" class="draggable">
  <img src="Mikul√°≈°.png" draggable="true" class="draggable">
  <img src="Perchta.png" draggable="true" class="draggable">
  <img src="≈Ωber.png" draggable="true" class="draggable">

  <button id="save">üì• St√°hnout pohlednici</button>
</div>

<!-- Pl√°tno -->
<div id="canvas"></div>

<!-- Knihovny -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/interact.js/1.10.11/interact.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
const canvas = document.getElementById("canvas");


// -------------------------------
// 1) DRAG & DROP FUNKCE NA PC
// -------------------------------
document.querySelectorAll(".draggable").forEach(img => {
  img.addEventListener("dragstart", e => {
    e.dataTransfer.setData("src", e.target.src);
  });
});

canvas.addEventListener("dragover", e => e.preventDefault());

canvas.addEventListener("drop", e => {
  e.preventDefault();
  const src = e.dataTransfer.getData("src");
  placeNewItem(src, e.offsetX, e.offsetY);
});


// -------------------------------
// 2) MOBILN√ç P≈òETA≈ΩEN√ç (touch)
// -------------------------------
let touchItem = null;

document.querySelectorAll(".draggable").forEach(img => {

  img.addEventListener("touchstart", e => {
    e.preventDefault();
    const touch = e.touches[0];

    // vytvo≈ô√≠me doƒçasnou postavu, kter√° se t√°hne
    touchItem = document.createElement("img");
    touchItem.src = img.src;
    touchItem.classList.add("item");
    touchItem.style.position = "fixed";
    touchItem.style.width = "120px";
    touchItem.style.left = (touch.clientX - 60) + "px";
    touchItem.style.top = (touch.clientY - 60) + "px";
    document.body.appendChild(touchItem);
  });

  img.addEventListener("touchmove", e => {
    if (!touchItem) return;
    const touch = e.touches[0];
    touchItem.style.left = (touch.clientX - 60) + "px";
    touchItem.style.top = (touch.clientY - 60) + "px";
  });

  img.addEventListener("touchend", e => {
    if (!touchItem) return;

    const rect = canvas.getBoundingClientRect();
    const x = parseInt(touchItem.style.left);
    const y = parseInt(touchItem.style.top);

    // Pokud pust√≠me nad pl√°tnem, vlo≈æ√≠me postavu
    if (
      x > rect.left &&
      x < rect.right &&
      y > rect.top &&
      y < rect.bottom
    ) {
      placeNewItem(
        touchItem.src,
        x - rect.left,
        y - rect.top
      );
    }

    touchItem.remove();
    touchItem = null;
  });
});


// -------------------------------
// Funkce pro vlo≈æen√≠ nov√© postavy na pl√°tno
// -------------------------------
function placeNewItem(src, x, y) {
  const el = document.createElement("img");
  el.src = src;
  el.classList.add("item");
  el.style.left = x + "px";
  el.style.top = y + "px";
  canvas.appendChild(el);
  initInteractions(el);
}


// -------------------------------
// Pohyb a zmƒõna velikosti
// -------------------------------
function initInteractions(el) {
  interact(el)
    .draggable({
      listeners: {
        move(event) {
          const x = (parseFloat(el.getAttribute('data-x')) || 0) + event.dx;
          const y = (parseFloat(el.getAttribute('data-y')) || 0) + event.dy;

          el.style.transform = `translate(${x}px, ${y}px)`;
          el.setAttribute('data-x', x);
          el.setAttribute('data-y', y);
        }
      }
    })
    .resizable({
      edges: { left: true, right: true, bottom: true, top: true }
    })
    .on('resizemove', event => {
      let { x, y } = event.target.dataset;

      event.target.style.width = event.rect.width + 'px';
      event.target.style.height = event.rect.height + 'px';

      x = (parseFloat(x) || 0) + event.deltaRect.left;
      y = (parseFloat(y) || 0) + event.deltaRect.top;

      event.target.style.transform = `translate(${x}px, ${y}px)`;

      event.target.dataset.x = x;
      event.target.dataset.y = y;
    });
}


// -------------------------------
// Ulo≈æen√≠ pohlednice jako PNG
// -------------------------------
document.getElementById("save").addEventListener("click", () => {
  html2canvas(canvas).then(canvasImg => {
    const link = document.createElement("a");
    link.download = "vanoƒçn√≠_pohlednice.png";
    link.href = canvasImg.toDataURL("image/png");
    link.click();
  });
});
</script>

</body>
</html>
